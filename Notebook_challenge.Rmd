---
title: "1Da Cross-selling in banking challenge - Alessia / Jenni"
output: html_notebook
---
We are working with a dataset from a czech bank. 

Below we have loaded all the packages and data as well as organized and sturctured it so we can work with it.
loading all packages and data
```{r}
library(tidyverse)
library(tidymodels)
library(ggmosaic)
library(ggalluvial)
library(rpart)
library(rpart.plot)
library(gridExtra)
library(usethis)
library(ggplot2)
```

```{r}

account <- read.csv('./account.csv', sep = ";")
card <- read.csv('./card.csv', sep = ";")
client <- read.csv('./client.csv', sep = ";")
disp <- read.csv('./disp.csv', sep = ";")
district <- read.csv('./district.csv', sep = ';')
loan <- read.csv('./loan.csv', sep = ";")
order <- read.csv('./order.csv', sep = ";")
trans <- read.csv('./trans.csv', sep = ";")

```

separate in columns
```{r}
#update 02.10.2021: we found out that there is an easier way to split the csv into columns with the sep = ";"
#split up the lists in a form
# account <- account %>%
#   separate(account_id.district_id.frequency.date, c("account_id","district_id",'frequency', 'date'), ";")
#   colnames(account)[3] <- 'frequency_issuance'
# 
# card <- card %>%
#   separate(card_id.disp_id.type.issued, c('card_id', 'disp_id', 'type_of_card', 'issued'),';')
# 
# client <- client %>%
#   separate(client_id.birth_number.district_id, c('client_id','birth_num','district_id'),';')
# 
 # district <- district %>%
 #   separate(A1.A2.A3.A4.A5.A6.A7.A8.A9.A10.A11.A12.A13.A14.A15.A16, c('district_code','district_name','region','no_of_inhabitants','no_of_municipalities_with_inhabitants_<_499','no_of_municipalities_with_inhabitants_500-1999','no_of_municipalities_with_inhabitants_2000-9999','no_of_municipalities_with_inhabitants_>10000','no_of_cities','ratio_of_urban_inhabitants','avg_salary','unemploymant_rate_95','unemploymant_rate_96','no_of_enterpreneurs_per_1000_inhabitants','no_of_commited_crimes_95','no_of_commited_crimes_96'),';')
# 
# disp <- disp %>%
#   separate(disp_id.client_id.account_id.type, c('disp_id','client_id','account_id','type_of_disposition'),';')
# 
# loan <- loan %>%
#   separate(loan_id.account_id.date.amount.duration.payments.status,c('loan_id','account_id','date','amount','duration','monthly_payments','status'),';')
# 
# order <- order %>%
#   separate(order_id.account_id.bank_to.account_to.amount.k_symbol,c('order_id','account_id','bank_to','account_to','amount','k_symbol'),';')
# 
# trans <- trans %>%
#   separate(trans_id.account_id.date.type.operation.amount.balance.k_symbol.bank.account,c('trans_id','account_id','date','type','operation','amount','balance','k_symbol','bank','account'),';')

```

clean/organize account
```{r}

#reformat frequency_issuance into 3 new columns
account <- account %>%
  mutate(issuance_monthly = case_when(
    endsWith(frequency, 'MESICNE') ~ 1,
    TRUE ~ 0)
  )

account <- account %>%
  mutate(issuance_weekly = case_when(
    endsWith(frequency, 'TYDNE') ~ 1,
    TRUE ~ 0)
  )

account <- account %>%
  mutate(issuance_transaction = case_when(
    endsWith(frequency, 'PO OBRATU') ~ 1,
    TRUE ~ 0)
  )


#reformat date
account$date_ymd <- format(as.Date(as.character(account$date), "%y%m%d"), "19%y/%m/%d") 

account <- account %>%
  select(-date)

#factorize variables
account <- account %>% 
  mutate (frequency = as_factor(frequency), 
          issuance_monthly = as_factor(issuance_monthly), 
          issuance_weekly = as_factor(issuance_weekly), 
          issuance_transaction = as_factor(issuance_transaction),
          date_ymd = as.Date(date_ymd)
          ) %>%
  mutate(frequency = case_when(
    frequency == 'POPLATEK MESICNE' ~ 'monthly issuance',
    frequency == 'POPLATEK TYDNE' ~ 'weekly issuance',
    frequency == 'POPLATEK PO OBRATU' ~ 'issuance after transaction'
  ))
#str(account)
```

clean/organize card
```{r}

#reformat type_of_card into 3 new columns
card <- card %>%
  mutate(junior_card = case_when(
    type == 'junior' ~ 1,
    TRUE ~ 0)
  )

card <- card %>%
  mutate(classic_card = case_when(
    type == 'classic' ~ 1,
    TRUE ~ 0)
  )

card <- card %>%
  mutate(gold_card = case_when(
    type == 'gold' ~ 1,
    TRUE ~ 0)
  )

#reformat date
card$issued_date <- format(as.Date(as.character(card$issued), "%y%m%d"), "19%y/%m/%d")
#card <- card %>%
  #select(-issued)




#factorize variables
card <- card %>%
  mutate(type = as_factor(type), 
         junior_card = as_factor(junior_card), 
         classic_card = as_factor(classic_card),
         gold_card = as_factor(gold_card),
         issued_date = as.Date(issued_date)
         )

#str(card)

  
```

clean/organize client (Dani fragen)
```{r}

#reformat birth_number

client <- client %>%
  mutate(month = substr(birth_number, 3, 4)) %>%
  mutate(month = strtoi(month))

client <- client %>%
  mutate(gender = case_when(
    month > 12 ~ 'f',
    TRUE ~ 'm')
  )

client <- client %>%
  mutate(birth_number = as.numeric(birth_number))

client <- client %>%
  mutate(birth_number = case_when(
    month > 12 ~ birth_number - 5000,
    TRUE ~ birth_number)
  )



client$birthday <- format(as.Date(as.character(client$birth_number), "%y%m%d"), "19%y/%m/%d")
# client <- client %>%
#   select(-birth_number)

#factorize variables
client <- client %>%
  mutate(district_id = as_factor(district_id), 
         gender = as_factor(gender),
         birthday = as.Date(birthday)
         )

library(eeptools)
x <- as.Date(c("1998-01-01"))


client$age <- floor(age_calc(as.Date(client$birthday),x, units = "years"))

# client <- client %>%
#   mutate(age = 
#     
#   )

#str(client)
  
```

birthday proper shape
```{r}
client <- client %>%
  mutate(
    birth_number = birth_number + 19000000
  )

# client <- client %>%
#   birth_number += '19' 
```

clean/organize disp
```{r}

#reformat type into 2 new columns
disp <- disp %>%
  mutate(owner = case_when(
    type == 'OWNER' ~ 1,
    TRUE ~ 0)
  )
disp <- disp %>%
  mutate(disponent = case_when(
    type == 'DISPONENT' ~ 1,
    TRUE ~ 0)
  )

#factorize variables
disp <- disp %>%
  mutate(type = as_factor(type), 
         owner = as_factor(owner), 
         disponent = as_factor(disponent)
         )

#str(disp)
```

clean/organize district
```{r}

#rename coluns
names(district) <- c('district_id', 'district_name', 'region', 'habitants', 'municipalities<499',
                     'municipalities<500-1000', 'municipalities<2000-9999', 'municipalities>10000', 'cities',
                     'ratio_urban_inhabitants', 'average_salary', 'unemployment_rate_1995', 'unemployment_rate_1996',
                     'enterpreneurs_per_1000', 'crimes_1995', 'crimes_1996')

#factorize variables
district <- district %>%
  mutate(district_name = as_factor(district_name), region = as_factor(region))

#change datatype to numeric/int
district <- district %>% 
  mutate(unemployment_rate_1995 = as.numeric(unemployment_rate_1995), 
         enterpreneurs_per_1000 = strtoi(enterpreneurs_per_1000), 
         crimes_1995 = strtoi(crimes_1995)
         )

#str(district)

```

clean/organize loan
```{r}

#reformat date
loan$date_issued <- format(as.Date(as.character(loan$date), "%y%m%d"), "19%y/%m/%d")
loan <- loan %>%
  select(-date)

#reformat status into 4 new columns
loan <- loan %>%
  mutate(in_debt = case_when(
    status == 'D' ~ 1,
    TRUE ~ 0)
  )

loan <- loan %>%
  mutate(ok_so_far= case_when(
    status == 'C' ~ 1,
     TRUE ~ 0)
  )

loan <- loan %>%
  mutate(loan_not_payed= case_when(
    status == 'B'~ 1,
    TRUE ~ 0)
  )

loan <- loan %>%
  mutate(payed_off= case_when(
    status == 'A'~ 1,
    TRUE ~ 0)
  )

#factorize variables
loan <- loan %>%
  mutate(duration = as_factor(duration), 
         status = as_factor(status),
         in_debt = as_factor(in_debt), 
         ok_so_far = as_factor(ok_so_far), 
         loan_not_payed = as_factor(loan_not_payed), 
         payed_off = as_factor(payed_off),
         date_issued = as.Date(date_issued)
         )


#str(loan)

```

clean/organize order
```{r}

#reformat k_symbol into 4 new columns
order <- order %>%
  mutate(insurrance_payment = case_when(
    k_symbol == 'POJISTNE' ~ 1,
    TRUE ~ 0)
  )

order <- order %>%
  mutate(household = case_when(
    k_symbol == 'SIPO' ~ 1,
    TRUE ~ 0)
  )

order <- order %>%
  mutate(for_leasing = case_when(
    k_symbol == 'LEASING' ~ 1,
    TRUE ~ 0)
  )

order <- order %>%
  mutate(loan_payment = case_when(
    k_symbol == 'UVER' ~ 1,
    TRUE ~ 0)
  )

#factorize variables
order <- order %>%
  mutate(bank_to = as_factor(bank_to), 
         k_symbol = as_factor(k_symbol), 
         insurrance_payment = as_factor(insurrance_payment), 
         household = as_factor(household), 
         for_leasing = as_factor(for_leasing), 
         loan_payment = as_factor(loan_payment)
         )


order <- order %>%
  mutate(k_symbol = case_when(
    k_symbol == 'POJISTNE' ~ 'issurance payment',
    k_symbol == 'SIPO' ~ 'household',
    k_symbol == 'LEASING' ~ 'leasing',
    k_symbol == 'UVER' ~ 'loan payment'
  )
    
  )
#str(order)
```

clean/organize trans
```{r}

#reformat date
trans$date_dmy <- format(as.Date(as.character(trans$date), "%y%m%d"), "19%y/%m/%d")

#reformat type into 2 new columns
trans <- trans %>%
  mutate(credit = case_when(
    type == 'PRIJEM' ~ 1,
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(withdrawal = case_when(
    type == 'VYDAJ' ~ 1,
    TRUE ~ 0)
  )

#reformat operation into 5 new columns
trans <- trans %>%
  mutate(creditcard_wd = case_when(
    operation == 'VYBER KARTOU' ~ 1,
    TRUE ~ 0)
  )
  
trans <- trans %>%
  mutate(credit_cash = case_when(
    operation == 'VKLAD' ~ 1,
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(col_from_other_bank = case_when(
    operation == 'PREVOD Z UCTU' ~ 1, 
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(wd_cash = case_when(
    operation == 'VYBER' ~ 1,
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(rem_to_other_bank = case_when(
    operation == 'PREVOD NA UCET' ~ 1,
    TRUE ~ 0)
  )

#reformat k_symbol into 7 new columns
trans <- trans %>%
  mutate(ks_insurrance_payment = case_when(
    k_symbol == 'POJISTNE' ~ 1,
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(ks_payment_of_statement = case_when(
    k_symbol == 'SLUZBY' ~ 1,
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(ks_interest_credit = case_when(
    k_symbol == 'UROK' ~ 1,
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(ks_interest_if_n_balance = case_when(
    k_symbol == 'SANKC. UROK' ~ 1,
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(ks_household = case_when(
    k_symbol == 'SIPO' ~ 1,
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(ks_old_age_pension = case_when(
    k_symbol == 'DUCHOD' ~ 1,
    TRUE ~ 0)
  )

trans <- trans %>%
  mutate(ks_loan_payment = case_when(
    k_symbol == 'UVER' ~ 1,
    TRUE ~ 0)
  )

#factorize variables
trans <- trans %>%
  mutate(type = as_factor(type),
         credit = as_factor(credit), 
         withdrawal = as_factor(withdrawal), 
         creditcard_wd = as_factor(creditcard_wd),
         operation = as_factor(operation), 
         credit_cash = as_factor(credit_cash), 
         col_from_other_bank = as_factor(col_from_other_bank), 
         wd_cash = as_factor(wd_cash), 
         rem_to_other_bank = as_factor(rem_to_other_bank), 
         ks_insurrance_payment = as_factor(ks_insurrance_payment),
         k_symbol = as_factor(k_symbol), 
         ks_insurrance_payment = as_factor(ks_insurrance_payment),
         ks_payment_of_statement = as_factor(ks_payment_of_statement), 
         ks_interest_credit = as_factor(ks_interest_credit), 
         ks_interest_if_n_balance = as_factor(ks_interest_if_n_balance), 
         ks_household = as_factor(ks_household),
         ks_old_age_pension = as_factor(ks_old_age_pension), 
         ks_loan_payment = as_factor(ks_loan_payment),
         date_dmy = as.Date(date_dmy)
         )

trans <- trans %>%
  mutate(type = case_when(
    type == 'PRIJEM' ~ 'credit',
    type == 'VYDAJ' ~ 'withdrawal'
  )) %>%
  mutate(operation = case_when(
    operation == 'VYBER KARTOU' ~ 'credit card withdrawal',
    operation == 'VKLAD' ~ 'credit in cash',
    operation == 'PREVOD Z UCTU' ~ 'collection from other bank',
    operation == 'VYBER' ~ 'withdrawal in cash',
    operation == 'PREVOD NA UCET' ~ 'remittance to other bank'
  )) %>%
  mutate(k_symbol = case_when(
    k_symbol == 'POJISTNE' ~ 'insurrance payment',
    k_symbol == 'SLUZBY' ~ 'payment for statement',
    k_symbol == 'UROK' ~ 'interest credited',
    k_symbol == 'SIPO' ~ 'hosehold',
    k_symbol == 'DUCHOD' ~ 'old-age pension',
    k_symbol == 'UVER' ~ 'loan payment'
  ))

#str(trans)

```

Bring together client and disp
```{r}
client_disp <- full_join(
    disp,client, by = 'client_id'
) 

client_disp <- full_join(
  client_disp, card, by = 'disp_id'
)

client_disp <- client_disp %>%
  rename(
    type_client = type.x,
    type_card = type.y,
    card_issued = issued_date
  ) %>%
  select(
    - birth_number,
    - month,
    - issued
  )

client_disp <- client_disp[,c(1,2,3,11,7,8,10,4,12,9,5,6,13,14,15,16)]


#gender count aller clients
gender_group <- client_disp %>%
 count(gender)
gender_group

#type count aller clients
gen_client_group <- client_disp %>%
  count(type_client)
gen_client_group

#gender count nach type
gen_client_test<- client_disp %>%
  group_by(gender) %>%
  count(type_client)
gen_client_test

#herausfinden ob 1 client mehrere accounts

# gender spread czeck republik 1998 female 51.37% https://data.worldbank.org/indicator/SP.POP.TOTL.FE.ZS?end=1998&locations=CZ&start=1998
```


Districts
```{r}



```

Fragestellung Recherche Jenni

Quick overview research to get to know the outlines of the dataset and decide where to go deeper.


First i wanted to see the genderdistribution of the clients.

As we can see in the Plot below, there are slightly less women than man, but over all the gender is pretty balanced out.
```{r}
client_gender_j <-ggplot(
  client, aes(x = gender, fill = gender))+
  geom_bar()+
  ggtitle('\nClients spread on gender\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )+
  labs( y= '\nNumber of Clients\n', x = '\nGender\n')
client_gender_j

```

```{r}
client_owner_j <-ggplot(
  client_disp, aes(x = type_client,fill = gender ))+
  geom_bar(position ='dodge')+
  ggtitle('\nOwner/Disponent spread on gender\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )+
  geom_text(aes(label = ..count..), stat = "count", position =  position_dodge(width = 0.9), vjust = 2)+
  labs( y= '\nNumber of Clients\n', x = '\nGender\n')
client_owner_j

#weiter untersuchen, wer macht die Überweisungen und altersgruppen
#check mit count

print(count(client_disp))

owner_total <- sum(client_disp$type_client== 'OWNER')
cat('Total OWNER:', owner_total) 

dispo_total <- sum(client_disp$ype_client== 'DISPONENT')
cat('Total DISPONENT: ', dispo_total)

female_client <- sum(client_disp$gender == 'f')
cat('Total female clients: ',female_client)

male_client <- sum(client_disp$gender == 'm')
cat('Total male clients: ',female_client)

print('There is an equal amount of male and female clients. That is very surprising. We will have a deeper look at this.')
# da stimmt etwas nicht. Bei clients sagts es sind 5369 observationen, wenn mann nach gender odrnet sind immer zu viele das erste geschlecht.????


      

```


The general information of the Age of the clients is a good base information as well.

We gan see in the plot below most clients are between 20 and 55 years old. 

```{r}
client_age_j <- ggplot(
  client, aes(x = age, colour = gender))+
  #geom_bar(alpha = 0.5)+
  geom_density()+
  ggtitle('\nClientspread on age, separated by gender\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )+
  labs( y = '\ndensity\n', x = '\nAge\n')
  
client_age_j

age_count <- client %>%
  group_by(gender, age) %>%
  summarise(
    count = n()
  )
age_count


client_age_jl <- ggplot(
  age_count, aes(x = age, colour = gender, y = count))+
  #geom_bar(alpha = 0.5)+
  # geom_point()+
  geom_line()+
  ggtitle('\nClientspread on age, separated by gender\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
client_age_jl


```




```{r}
card_type_j <- ggplot(
  card, aes(x = type, fill = type))+
  geom_bar()+
  ggtitle('\nSpread of card types\n')+
  geom_text(aes(label = ..count..), stat = "count", position =  position_dodge(width = 0.9), vjust = 2)+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
  
card_type_j

card_type_jx <- ggplot(
  client_disp, aes(x = type_client, fill = gender))+
  geom_bar(position = 'dodge')+
  ggtitle('\nSpread of card types\n')+
  geom_text(aes(label = ..count..), stat = "count", position =  position_dodge(width = 0.9), vjust = 2)+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
  
card_type_jx

# client_owner_j <-ggplot(
#   client_disp, aes(x = type.x,fill = gender ))+
#   geom_bar(position ='dodge')+
#   ggtitle('\nOwner/Disponent spread on gender\n')+
#   theme(
#     plot.title = element_text(hjust = 0.5)
#     )+
#   geom_text(aes(label = ..count..), stat = "count", position =  position_dodge(width = 0.9), vjust = 2)+
#   labs( y= '\nNumber of Clients\n', x = '\nGender\n')
# client_owner_j

```


```{r}
card_type_g_j <- ggplot(
  client_disp, aes(x = type_card, fill = gender))+
  geom_bar(position = 'dodge')+
  ggtitle('\nSpread of card types\n')+
  geom_text(aes(label = ..count..), stat = "count", position =  position_dodge(width = 0.9), vjust = 2)+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
  
card_type_g_j
```
```{r}
card_type_age_g <- ggplot(
  client_disp, aes(x = age, colour = type_card))+
  geom_density(position = 'dodge')+
  ggtitle('\nSpread of card types\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
card_type_age_g

age_card <- client_disp %>%
  group_by( type_card, age ) %>%
  summarise(
    count = n()
  )
age_card

card_type_age <- ggplot(
  age_card, aes(x = age, y = count, colour = type_card))+
  geom_line(position = 'dodge')+
  ggtitle('\nSpread of card types\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
  
card_type_age


age_card_m <- filter(client_disp, gender == 'm')
age_card_m

age_card_f <- filter(client_disp, gender == 'f')
age_card_f

age_card_m <- age_card_m %>%
  group_by(age, type_card) %>%
  summarise(
    count = n()
  ) 

age_card_f <- age_card_f %>%
  group_by(age, type_card) %>%
  summarise(
    count = n()
  ) 


card_type_age_m <- ggplot(
  age_card_m, aes(x = age, y = count, colour = type_card))+
  geom_line(position = 'dodge')+
  ggtitle('\nSpread of card types of male clients\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
  
card_type_age_m

card_type_age_f <- ggplot(
  age_card_f, aes(x = age, y = count, colour = type_card))+
  geom_line(position = 'dodge')+
  ggtitle('\nSpread of card types of female clients\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
  
card_type_age_f
```


```{r}
# filter by card, make dataframe for each card type

#wenn junior_card is true pipe into new data frame
client_junior <- filter(client_disp , junior_card == 1)
client_classic <- filter(client_disp , classic_card == 1)
client_gold <- filter(client_disp , gold_card == 1)

client_all_cards <- client_disp %>%
  filter(!is.na(type_card))

client_na <- client_disp %>%
  filter(is.na(type_card))

client_na

client_na_junior <- filter(client_na, age <= 23)
client_na_classic_gold <- filter(client_na, age > 23)
```

```{r}
# client_junior$age_card_issued2 <- client_junior$card_issued - client_junior$birthday 
client_junior$age_card_issued <- floor(age_calc(as.Date(client_junior$birthday),client_junior$card_issued, units = "years"))

junior_issued_age_viz <- ggplot( client_junior, aes( x = age_card_issued, fill = gender))+
  geom_bar( position = 'dodge'
  )+
  # geom_density()+
  ggtitle('\nJunior cards issued on age of owner\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
junior_issued_age_viz

client_na_junior_age_viz <- ggplot(client_na_junior, aes(x=age, fill=gender))+
  geom_bar(position = 'dodge')+
  ggtitle('\npotential junior card clients age spread\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
  )
client_na_junior_age_viz

```
```{r}
client_classic$age_card_issued <- floor(age_calc(as.Date(client_classic$birthday),client_classic$card_issued, units = 'years'))
client_gold$age_card_issued <- floor(age_calc(as.Date(client_gold$birthday),client_gold$card_issued, units = 'years'))

classic_issued_age_viz <- ggplot(client_classic, aes( x = age, fill = gender))+
  geom_bar(position = 'dodge')+
  ggtitle('\nClassic cards issued on age of owner\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
classic_issued_age_viz

#nehmen wir alle ab 20 zu der gruppe potential classic????????

gold_issued_age_viz <- ggplot(client_gold, aes( x = age, fill = gender))+
  geom_bar(position = 'dodge')+
  ggtitle('\nGold cards issued on age of owner\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
    )
gold_issued_age_viz

```

```{r}
#join card information to traansactions via account id

cardowner_transactions <- inner_join(client_all_cards, trans, by = 'account_id') %>%
  mutate(trans_credit =
    case_when(
      type == 'credit' ~ 1,
      type != 'credit' ~ 0
    )
  ) %>%
  mutate(trans_withdrawal =
           case_when(
             type == 'withdrawal' ~ 1,
             type != 'withdrawal' ~ 0
           )
    
  )

junior_card_transactions <- filter(cardowner_transactions, type_card == 'junior')
classic_card_transactions <- filter(cardowner_transactions, type_card == 'classic')
gold_card_transactions <- filter(cardowner_transactions, type_card == 'gold')
```


```{r}
junior_card_transactions_2 <- junior_card_transactions %>%
  group_by(account_id, type) %>%
  summarise(
    count = n()
  ) 
junior_card_transactions_2



```









```{r}

#zuerst durchschnitt pro gender berechnen











junior_trans_viz <- ggplot(junior_card_transactions, aes( x = type, fill = gender))+
  geom_bar(position = 'dodge')+
  ggtitle('\nIncome compared to withdrawals Junior Card\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
  )
junior_trans_viz

classic_trans_viz <- ggplot(classic_card_transactions, aes( x = type, fill = gender))+
  geom_bar(position = 'dodge')+
  ggtitle('\nIncome compared to withdrawals classic card\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
  )
classic_trans_viz

gold_trans_viz <- ggplot(gold_card_transactions, aes( x = type, fill = gender))+
  geom_bar(position = 'dodge')+
  ggtitle('\nIncome compared to withdrawals gold card\n')+
  theme(
    plot.title = element_text(hjust = 0.5)
  )
gold_trans_viz
```




